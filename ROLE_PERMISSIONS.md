# ğŸ” **PhÃ¢n Quyá»n Há»‡ Thá»‘ng Äáº·t VÃ© Xe**

## ğŸ“‹ **Tá»•ng Quan**

Há»‡ thá»‘ng cÃ³ **2 role chÃ­nh**:

- **`Customer`** - KhÃ¡ch hÃ ng thÃ´ng thÆ°á»ng
- **`Admin`** - Quáº£n trá»‹ viÃªn (gá»™p cáº£ Staff)

---

## ğŸ‘¤ **Customer (KhÃ¡ch hÃ ng)**

### âœ… **Chá»©c nÄƒng Ä‘Æ°á»£c phÃ©p:**

- ğŸ” **TÃ¬m kiáº¿m chuyáº¿n xe** - TÃ¬m theo Ä‘iá»ƒm Ä‘i/Ä‘áº¿n, ngÃ y
- ğŸ“‹ **Xem danh sÃ¡ch chuyáº¿n xe** - Xem táº¥t cáº£ chuyáº¿n xe cÃ³ sáºµn
- ğŸšŒ **Xem chi tiáº¿t chuyáº¿n xe** - ThÃ´ng tin xe, giá» khá»Ÿi hÃ nh, giÃ¡ vÃ©
- ğŸ’º **Chá»n gháº¿ ngá»“i** - Xem sÆ¡ Ä‘á»“ gháº¿ vÃ  chá»n gháº¿ trá»‘ng
- ğŸ« **Äáº·t vÃ©** - Táº¡o booking má»›i
- ğŸ“± **Xem vÃ© cá»§a mÃ¬nh** - Danh sÃ¡ch vÃ© Ä‘Ã£ Ä‘áº·t
- âŒ **Há»§y vÃ©** - Há»§y vÃ© chÆ°a thanh toÃ¡n
- ğŸ” **ÄÄƒng nháº­p/ÄÄƒng kÃ½** - Quáº£n lÃ½ tÃ i khoáº£n cÃ¡ nhÃ¢n

### âŒ **Chá»©c nÄƒng bá»‹ cáº¥m:**

- Quáº£n lÃ½ chuyáº¿n xe
- Check-in khÃ¡ch hÃ ng
- Xem táº¥t cáº£ booking
- QuÃ©t QR code
- Quáº£n lÃ½ ngÆ°á»i dÃ¹ng

---

## ğŸ‘¨â€ğŸ’¼ **Admin (Quáº£n trá»‹ viÃªn)**

### âœ… **Chá»©c nÄƒng Ä‘Æ°á»£c phÃ©p:**

#### ğŸ  **Dashboard & Thá»‘ng kÃª**

- ğŸ“Š **Dashboard tá»•ng quan** - Thá»‘ng kÃª tá»•ng sá»‘ vÃ©, chuyáº¿n xe, ngÆ°á»i dÃ¹ng
- ğŸ“ˆ **BÃ¡o cÃ¡o doanh thu** - Thá»‘ng kÃª theo ngÃ y/tuáº§n/thÃ¡ng

#### ğŸšŒ **Quáº£n lÃ½ Chuyáº¿n Xe**

- â• **ThÃªm chuyáº¿n xe má»›i** - Táº¡o chuyáº¿n xe vá»›i thÃ´ng tin Ä‘áº§y Ä‘á»§
- âœï¸ **Sá»­a chuyáº¿n xe** - Cáº­p nháº­t thÃ´ng tin chuyáº¿n xe
- ğŸ—‘ï¸ **XÃ³a chuyáº¿n xe** - XÃ³a chuyáº¿n xe khÃ´ng cáº§n thiáº¿t
- ğŸ“‹ **Xem táº¥t cáº£ chuyáº¿n xe** - Danh sÃ¡ch Ä‘áº§y Ä‘á»§ cÃ¡c chuyáº¿n xe

#### ğŸ« **Quáº£n lÃ½ Äáº·t VÃ©**

- ğŸ“‹ **Xem táº¥t cáº£ booking** - Danh sÃ¡ch Ä‘áº·t vÃ© cá»§a táº¥t cáº£ khÃ¡ch hÃ ng
- âŒ **Há»§y vÃ© báº¥t ká»³** - Há»§y vÃ© cá»§a báº¥t ká»³ khÃ¡ch hÃ ng nÃ o
- ğŸ” **TÃ¬m kiáº¿m booking** - TÃ¬m theo tÃªn, sá»‘ Ä‘iá»‡n thoáº¡i, mÃ£ vÃ©

#### âœ… **Check-in & XÃ¡c thá»±c**

- ğŸ“± **Check-in khÃ¡ch hÃ ng** - XÃ¡c nháº­n khÃ¡ch hÃ ng lÃªn xe
- ğŸ” **QuÃ©t QR code** - QuÃ©t mÃ£ QR Ä‘á»ƒ xÃ¡c thá»±c vÃ©
- âœ… **XÃ¡c thá»±c vÃ©** - Kiá»ƒm tra tÃ­nh há»£p lá»‡ cá»§a vÃ©

#### ğŸ‘¥ **Quáº£n lÃ½ NgÆ°á»i dÃ¹ng**

- ğŸ“‹ **Xem danh sÃ¡ch ngÆ°á»i dÃ¹ng** - Táº¥t cáº£ tÃ i khoáº£n trong há»‡ thá»‘ng
- â• **Táº¡o tÃ i khoáº£n Admin** - ThÃªm quáº£n trá»‹ viÃªn má»›i
- ğŸ”„ **Cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng** - Sá»­a thÃ´ng tin cÃ¡ nhÃ¢n

#### ğŸ“Š **BÃ¡o cÃ¡o & Audit**

- ğŸ“ **Xem audit log** - Lá»‹ch sá»­ hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng
- ğŸ“Š **BÃ¡o cÃ¡o chi tiáº¿t** - Thá»‘ng kÃª theo nhiá»u tiÃªu chÃ­

---

## ğŸ”— **API Endpoints theo Role**

### ğŸŒ **Public APIs (KhÃ´ng cáº§n Ä‘Äƒng nháº­p)**

```
POST /api/auth/register
POST /api/auth/login
GET  /api/trips/search
GET  /api/trips/{id}
```

### ğŸ‘¤ **Customer APIs (Cáº§n Ä‘Äƒng nháº­p)**

```
GET  /api/bookings/my-bookings
POST /api/bookings
PUT  /api/bookings/{id}/cancel
GET  /api/bookings/{id}
```

### ğŸ‘¨â€ğŸ’¼ **Admin APIs (Cáº§n Ä‘Äƒng nháº­p + Role = Admin)**

```
GET  /api/admin/dashboard
GET  /api/admin/trips
GET  /api/admin/bookings
GET  /api/admin/users
POST /api/admin/checkin
GET  /api/admin/verify
DELETE /api/admin/bookings/{id}
```

---

## ğŸ›¡ï¸ **Báº£o máº­t**

### ğŸ” **JWT Token**

- Má»—i user Ä‘Äƒng nháº­p sáº½ nháº­n JWT token
- Token chá»©a thÃ´ng tin: `UserId`, `Role`, `Email`
- Token cÃ³ thá»i háº¡n vÃ  cáº§n refresh

### ğŸš« **Authorization Middleware**

- Táº¥t cáº£ API Ä‘á»u kiá»ƒm tra JWT token
- Admin APIs kiá»ƒm tra thÃªm `Role = "Admin"`
- Tráº£ vá» `403 Forbidden` náº¿u khÃ´ng cÃ³ quyá»n

### ğŸ“ **Audit Logging**

- Ghi láº¡i táº¥t cáº£ hoáº¡t Ä‘á»™ng quan trá»ng
- Theo dÃµi ai lÃ m gÃ¬, khi nÃ o
- Báº£o máº­t vÃ  tuÃ¢n thá»§ quy Ä‘á»‹nh

---

## ğŸ¯ **VÃ­ dá»¥ Sá»­ dá»¥ng**

### ğŸ‘¤ **Customer Ä‘áº·t vÃ©:**

1. ÄÄƒng nháº­p vá»›i role `Customer`
2. TÃ¬m kiáº¿m chuyáº¿n xe
3. Chá»n gháº¿ vÃ  Ä‘áº·t vÃ©
4. Xem vÃ© trong "My Bookings"

### ğŸ‘¨â€ğŸ’¼ **Admin quáº£n lÃ½:**

1. ÄÄƒng nháº­p vá»›i role `Admin`
2. Xem dashboard tá»•ng quan
3. Quáº£n lÃ½ chuyáº¿n xe
4. Check-in khÃ¡ch hÃ ng
5. Xem bÃ¡o cÃ¡o

---

## ğŸ”„ **Workflow PhÃ¢n Quyá»n**

```mermaid
graph TD
    A[User Login] --> B{Role Check}
    B -->|Customer| C[Customer Dashboard]
    B -->|Admin| D[Admin Dashboard]

    C --> E[Search Trips]
    C --> F[Book Tickets]
    C --> G[View My Bookings]

    D --> H[Manage Trips]
    D --> I[View All Bookings]
    D --> J[Check-in Passengers]
    D --> K[User Management]
```

---

## ğŸ“± **Flutter App Integration**

### ğŸ”§ **Cáº¥u hÃ¬nh API**

```dart
// lib/config/api_config.dart
class ApiConfig {
  static const String localhostUrl = 'https://localhost:7000/api';
  static const bool useMockData = false; // Sá»­ dá»¥ng real API
}
```

### ğŸ¯ **Role-based Navigation**

```dart
// Kiá»ƒm tra role Ä‘á»ƒ Ä‘iá»u hÆ°á»›ng
if (user.role == 'Admin') {
  // Hiá»ƒn thá»‹ Admin Dashboard
} else {
  // Hiá»ƒn thá»‹ Customer Dashboard
}
```

---

## ğŸš€ **Káº¿t luáº­n**

Há»‡ thá»‘ng phÃ¢n quyá»n Ä‘Æ¡n giáº£n vá»›i 2 role chÃ­nh:

- **Customer**: Táº­p trung vÃ o tráº£i nghiá»‡m Ä‘áº·t vÃ©
- **Admin**: Quáº£n lÃ½ toÃ n bá»™ há»‡ thá»‘ng

Äiá»u nÃ y giÃºp:

- âœ… ÄÆ¡n giáº£n hÃ³a quáº£n lÃ½
- âœ… Báº£o máº­t tá»‘t hÆ¡n
- âœ… Dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng
- âœ… PhÃ¹ há»£p vá»›i quy mÃ´ vá»«a vÃ  nhá»
